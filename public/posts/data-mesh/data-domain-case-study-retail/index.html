<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Data Domain Fictional Case Study: Retail | Ust Does Tech</title>
<meta name="keywords" content="">
<meta name="description" content="Using a fictionalised case study to understand how data domains could work in practice">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/data-mesh/data-domain-case-study-retail/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6da9a63d25a9608bca2f7f907a030e887a7dd3c3f3918e4cc113129361414bda.css" integrity="sha256-bammPSWpYIvKL3&#43;QegMOiHp908PzkY5MwRMSk2FBS9o=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/data-mesh/data-domain-case-study-retail/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/posts/data-mesh/data-domain-case-study-retail/">
  <meta property="og:site_name" content="Ust Does Tech">
  <meta property="og:title" content="Data Domain Fictional Case Study: Retail">
  <meta property="og:description" content="Using a fictionalised case study to understand how data domains could work in practice">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2021-08-17T08:55:25+06:00">
    <meta property="article:modified_time" content="2021-08-17T08:55:25+06:00">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Data Domain Fictional Case Study: Retail">
<meta name="twitter:description" content="Using a fictionalised case study to understand how data domains could work in practice">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Data Mesh",
      "item": "http://localhost:1313/posts/data-mesh/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Data Domain Fictional Case Study: Retail",
      "item": "http://localhost:1313/posts/data-mesh/data-domain-case-study-retail/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Data Domain Fictional Case Study: Retail",
  "name": "Data Domain Fictional Case Study: Retail",
  "description": "Using a fictionalised case study to understand how data domains could work in practice",
  "keywords": [
    
  ],
  "articleBody": "In previous posts we’ve understood what is Data Mesh and gone into greater detail with regards to the principles. In this next series of posts I want to use a fictional case study to explore how the underlying principles could work in practice. This post will introduce the fictitious company; the challenges it faces; and how the principle of decentralised data ownership and architecture, with domain alignment, would work.\nFictitious Company: XclusiV XclusiV is a luxury retailer operating in multiple countries. It has two divisions, which operate almost as separate businesses, which we will call Division X and Division V. The Point-of-Sale (POS) and Enterprise Resource Planning (ERP) systems within each market that it operates is the same for each division, but the POS and ERP systems can vary between markets.\nEach division has their own stores but, occasionally, there are flagship XclusiV stores that house products and staff from both divisions.\nThe retail operations are supported by separate manufacturing and buying processes, separate marketing teams; as well as centralised distribution, IT, Finance, and HR capabilities.\nXclusiV Analytical Challenges The analytical challenges that XclusiV faces can be summarised as follows:\nCentralised Data Warehouse that treats both divisions and all markets the same A central Data Engineering team that has limited capacity to support the development of new features requested by business teams Shadow IT has sprung up to try to overcome the capacity limitations of the Data Engineering Team but has created more confusion The business teams do not feel like they own the data Very few business teams want to own the data We’ve got two themes for our challenges: poor analytical performance (which will impact business performance) and lack of data ownership.\nQuality of data is quite good, so there isn’t the usual data governance concerns, other than ownership.\nHow could Data Mesh help? Due to the lack of ownership of data, a data mesh might not be able to resolve the challenges at XclusiV. However, embarking on a journey which, ultimately, empowers users will go a long way to establishing data ownership within domains.\nThe organisational structure doesn’t make this a simple use case for data mesh. In other examples, there’s a clear separation between domains: user domain; playlist domain; artist domain etc., but in this example, the separation between domains isn’t so clean. I think one of the reasons why there’s a clear domain separation in other examples is due to a microservices architecture. XclusiV haven’t got around to implementing a microservices architecture and are still using line-of-business applications.\nWe could separate domains into Sale, Product, Customer, Location, Stock etc., and that would work quite nicely if there was system alignment across markets (and that is a technological hurdle which shouldn’t be insurmountable). The following diagram details the data flow from one domain to another with the operational capabilities in blue and the analytical endpoints in green. You’ll notice that there’s a fair few dependencies, and this is a simplified model.\nRegardless of whether XclusiV has embraced microservices or retain LOB applications, the logical flow of data between arbitrary domains would be the same. But who should own what?\nDomain Ownership Domains can span multiple subject areas and have many dependencies. Let’s take Sales and Stock, as the driving forces for business - without stock, there’s no sales. If there are no sales, there’s no business.\nRetail Operations Team In this example, the operational capabilities and associated analytical endpoints for Sales and Stock domains come under the ownership of the Retail Operations Team. They’re tightly aligned to the creation of data and with the operational analytical demands, like Weekly Sales Report and Weekly Stock Position. The team is responsible for the input of data, the quality of the data, and associated output.\nBut surely the Retail Operations Teams is responsible for everything in the POS?\nYes, at the moment that is how XclusiV currently arranges its business. But the Retail Operations Team aren’t actually that interested in domains like Customer, or Location, or Product - so why would they want to own it? The team is responsible for the day-to-day operations of the stores and not concerned with product development, customer relationships - that’s the preserve of other teams.\nCustomer Relationship Team Unsurprisingly, the Customer Relationship Team should own the Customer domain, as well as the CRM domain.\nThe Customer Relationship Team wants to ensure that the right customers are targeted, that the right customer relationships are nurtured, and the quality of the customer data is accurate - specifically with regards to GDPR requests. A poor service, at any engagement point, will damage the reputation of XclusiV and reflect poorly on the Customer Relationship Team.\nFinance Finance are typically the gatekeepers for investment, as well as divestment. If sales are growing, there could be scope for opening up more stores or expanding product ranges. Conversely, if sales are not growing then stores could be closed and the product range could be more limited. Those decisions all rely upon Finance to make, with the advice from other departments.\nWhat about the Sales Team?\nThis is where it can get complicated. I recommend that it’s Finance who own these domains as they make the final decision but I do recognise that there is a lot of overlap.\nSales Team There is a lot of overlap between the Sales Team and the Retail Operations and the Finance Teams.\nThe Sales Team could be responsible for the Sales Planning Domain, but I argue that they are consumers of the domain as they are targeted by Finance on sales, rather than setting targets and driving decisions based on the data. Conversely, in another organisation it could be the Sales Team who owns the domain and Finance is the consumer.\nBuying Team The Buying Team are responsible for buying products for the various stores based on the trends and types of products that have performed well in the past and expected to perform well in the future.\nTherefore, the Buying Team owns the Inventory Planning Domain as it needs to plan for inventory it needs to buy. However, you’ll notice that the Buying Team does not have ownership of the Product Domain. But who does?\nMarketing Marketing owns the Product Domain. Why Marketing and not Buying or Manufacturing? Because Marketing are most keenly interested in the product as they are entirely responsible for the success of a product, how it is marketed and it’s performance (from a sales perspective). Owners of Product Domain but consumers of the Sales Planning Domain. Marketing sets the brief for products to be created.\nManufacturing is concerned about output and quality of the product but they’re not that interested in the success of a product. Buying is concerned about the required inventory of the product, but not the product itself. That’s why Marketing is, in my opinion, the correct owner of the Product Domain.\nCross-Divisions The examples above assume a single division - but we know that XclusiV is a multi-divisional organisation. How will it work with more than one division? We can have duplication of domains - to reflect the physical division of the organisation. This will also allow th organisation to scale if it decides to create or acquire new divisions or even divest divisions.\nXclusiV could re-organise and have shared domains across the divisions, but this would be counter to the principles of data mesh, as domains should be aligned to the organisation. In addition, to re-organise into shared domains across divisions wouldn’t be scalable and would impose some of the same challenges and restrictions of the current analytical structure.\nFor cross-divisional functions, like IT, we’ll explore their role in Self-Serve Analytical Platform Fictional Case Study: Retail and for cross divisional consumers, like Group Finance, we’ll explore how they would consume data in Data Product Fictional Case Study: Retail\n",
  "wordCount" : "1305",
  "inLanguage": "en",
  "datePublished": "2021-08-17T08:55:25+06:00",
  "dateModified": "2021-08-17T08:55:25+06:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/data-mesh/data-domain-case-study-retail/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ust Does Tech",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Ust Does Tech (Alt + H)">Ust Does Tech</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Data Domain Fictional Case Study: Retail
    </h1>
    <div class="post-description">
      Using a fictionalised case study to understand how data domains could work in practice
    </div>
    <div class="post-meta"><span title='2021-08-17 08:55:25 +0600 +0600'>August 17, 2021</span>

</div>
  </header> 
  <div class="post-content"><p>In previous posts we&rsquo;ve understood what is <a href="../what-is-data-mesh/">Data Mesh</a> and gone into <a href="../data-mesh-deep-dive/">greater detail</a> with regards to the principles. In this next series of posts I want to use a fictional case study to explore how the underlying principles could work in practice. This post will introduce the fictitious company; the challenges it faces; and how the principle of decentralised data ownership and architecture, with domain alignment, would work.</p>
<h2 id="fictitious-company-xclusiv">Fictitious Company: XclusiV<a hidden class="anchor" aria-hidden="true" href="#fictitious-company-xclusiv">#</a></h2>
<p>XclusiV is a luxury retailer operating in multiple countries. It has two divisions, which operate almost as separate businesses, which we will call Division X and Division V. The Point-of-Sale (POS) and Enterprise Resource Planning (ERP) systems within each market that it operates is the same for each division, but the POS and ERP systems can vary between markets.</p>
<p>Each division has their own stores but, occasionally, there are flagship XclusiV stores that house products and staff from both divisions.</p>
<p>The retail operations are supported by separate manufacturing and buying processes, separate marketing teams; as well as centralised distribution, IT, Finance, and HR capabilities.</p>
<h2 id="xclusiv-analytical-challenges">XclusiV Analytical Challenges<a hidden class="anchor" aria-hidden="true" href="#xclusiv-analytical-challenges">#</a></h2>
<p>The analytical challenges that XclusiV faces can be summarised as follows:</p>
<ul>
<li>Centralised Data Warehouse that treats both divisions and all markets the same</li>
<li>A central Data Engineering team that has limited capacity to support the development of new features requested by business teams</li>
<li>Shadow IT has sprung up to try to overcome the capacity limitations of the Data Engineering Team but has created more confusion</li>
<li>The business teams do not feel like they own the data</li>
<li>Very few business teams want to own the data</li>
</ul>
<p>We&rsquo;ve got two themes for our challenges: poor analytical performance (which will impact business performance) and lack of data ownership.</p>
<p>Quality of data is quite good, so there isn&rsquo;t the usual data governance concerns, other than ownership.</p>
<h2 id="how-could-data-mesh-help">How could Data Mesh help?<a hidden class="anchor" aria-hidden="true" href="#how-could-data-mesh-help">#</a></h2>
<p>Due to the lack of ownership of data, a data mesh might not be able to resolve the challenges at XclusiV. However, embarking on a journey which, ultimately, empowers users will go a long way to establishing data ownership within domains.</p>
<p>The organisational structure doesn&rsquo;t make this a simple use case for data mesh. In other examples, there&rsquo;s a clear separation between domains: user domain; playlist domain; artist domain etc., but in this example, the separation between domains isn&rsquo;t so clean. I think one of the reasons why there&rsquo;s a clear domain separation in other examples is due to a microservices architecture. XclusiV haven&rsquo;t got around to implementing a microservices architecture and are still using line-of-business applications.</p>
<figure class="align-center ">
    <img loading="lazy" src="images/xclusiv-architecture.png#center"
         alt="Image with POS and ERP flowing into a Data Warehouse with Cube" width="600"/> 
</figure>

<p>We could separate domains into Sale, Product, Customer, Location, Stock etc., and that would work quite nicely if there was system alignment across markets (and that is a technological hurdle which shouldn&rsquo;t be insurmountable). The following diagram details the data flow from one domain to another with the operational capabilities in blue and the analytical endpoints in green. You&rsquo;ll notice that there&rsquo;s a fair few dependencies, and this is a simplified model.</p>
<figure class="align-center ">
    <img loading="lazy" src="images/data-flow-domains-xclusiv.png#center"
         alt="Image with the data flow between the different domains listed" width="900"/> 
</figure>

<p>Regardless of whether XclusiV has embraced microservices or retain LOB applications, the logical flow of data between arbitrary domains would be the same. But who should own what?</p>
<h3 id="domain-ownership">Domain Ownership<a hidden class="anchor" aria-hidden="true" href="#domain-ownership">#</a></h3>
<p>Domains can span multiple subject areas and have many dependencies. Let&rsquo;s take Sales and Stock, as the driving forces for business - without stock, there&rsquo;s no sales. If there are no sales, there&rsquo;s no business.</p>
<h4 id="retail-operations-team">Retail Operations Team<a hidden class="anchor" aria-hidden="true" href="#retail-operations-team">#</a></h4>
<figure class="align-center ">
    <img loading="lazy" src="images/data-flow-domain-ownership-ops-xclusiv.png#center"
         alt="Retail Operations Domain Ownership" width="500"/> 
</figure>

<p>In this example, the operational capabilities and associated analytical endpoints for Sales and Stock domains come under the ownership of the Retail Operations Team. They&rsquo;re tightly aligned to the creation of data and with the operational analytical demands, like <em>Weekly Sales Report</em> and <em>Weekly Stock Position</em>. The team is responsible for the input of data, the quality of the data, and associated output.</p>
<blockquote>
<p>But surely the Retail Operations Teams is responsible for everything in the POS?</p></blockquote>
<p>Yes, at the moment that is how XclusiV currently arranges its business. But the Retail Operations Team aren&rsquo;t actually that interested in domains like Customer, or Location, or Product - so why would they want to own it? The team is responsible for the day-to-day operations of the stores and not concerned with product development, customer relationships - that&rsquo;s the preserve of other teams.</p>
<h4 id="customer-relationship-team">Customer Relationship Team<a hidden class="anchor" aria-hidden="true" href="#customer-relationship-team">#</a></h4>
<p>Unsurprisingly, the Customer Relationship Team should own the Customer domain, as well as the CRM domain.</p>
<figure class="align-center ">
    <img loading="lazy" src="images/data-flow-domain-ownership-crm-xclusiv.png#center"
         alt="Customer Relationship Domain Ownership" width="500"/> 
</figure>

<p>The Customer Relationship Team wants to ensure that the right customers are targeted, that the right customer relationships are nurtured, and the quality of the customer data is accurate - specifically with regards to GDPR requests. A poor service, at any engagement point, will damage the reputation of XclusiV and reflect poorly on the Customer Relationship Team.</p>
<h4 id="finance">Finance<a hidden class="anchor" aria-hidden="true" href="#finance">#</a></h4>
<p>Finance are typically the gatekeepers for investment, as well as divestment. If sales are growing, there could be scope for opening up more stores or expanding product ranges. Conversely, if sales are not growing then stores could be closed and the product range could be more limited. Those decisions all rely upon Finance to make, with the advice from other departments.</p>
<figure class="align-center ">
    <img loading="lazy" src="images/data-flow-domain-ownership-finance-xclusiv.png#center"
         alt="Finance Domain Ownership" width="500"/> 
</figure>

<blockquote>
<p>What about the Sales Team?</p></blockquote>
<p>This is where it can get complicated. I recommend that it&rsquo;s Finance who own these domains as they make the final decision but I do recognise that there is a lot of overlap.</p>
<h4 id="sales-team">Sales Team<a hidden class="anchor" aria-hidden="true" href="#sales-team">#</a></h4>
<p>There is a lot of overlap between the Sales Team and the Retail Operations and the Finance Teams.</p>
<figure class="align-center ">
    <img loading="lazy" src="images/data-flow-domain-ownership-sales-xclusiv.png#center"
         alt="Finance Domain Ownership" width="500"/> 
</figure>

<p>The Sales Team could be responsible for the Sales Planning Domain, but I argue that they are consumers of the domain as they are targeted by Finance on sales, rather than setting targets and driving decisions based on the data. Conversely, in another organisation it could be the Sales Team who owns the domain and Finance is the consumer.</p>
<h4 id="buying-team">Buying Team<a hidden class="anchor" aria-hidden="true" href="#buying-team">#</a></h4>
<p>The Buying Team are responsible for buying products for the various stores based on the trends and types of products that have performed well in the past and expected to perform well in the future.</p>
<figure class="align-center ">
    <img loading="lazy" src="images/data-flow-domain-ownership-buying-xclusiv.png#center"
         alt="Buying Team Domain Ownership" width="500"/> 
</figure>

<p>Therefore, the Buying Team owns the Inventory Planning Domain as it needs to plan for inventory it needs to buy. However, you&rsquo;ll notice that the Buying Team does not have ownership of the Product Domain. But who does?</p>
<h4 id="marketing">Marketing<a hidden class="anchor" aria-hidden="true" href="#marketing">#</a></h4>
<p>Marketing owns the Product Domain. Why Marketing and not Buying or Manufacturing? Because Marketing are most keenly interested in the product as they are entirely responsible for the success of a product, how it is marketed and it&rsquo;s performance (from a sales perspective). Owners of Product Domain but consumers of the Sales Planning Domain. Marketing sets the brief for products to be created.</p>
<figure class="align-center ">
    <img loading="lazy" src="images/data-flow-domain-ownership-marketing-xclusiv.png#center"
         alt="Buying Team Domain Ownership" width="500"/> 
</figure>

<p>Manufacturing is concerned about output and quality of the product but they&rsquo;re not that interested in the success of a product. Buying is concerned about the required inventory of the product, but not the product itself. That&rsquo;s why Marketing is, in my opinion, the correct owner of the Product Domain.</p>
<h2 id="cross-divisions">Cross-Divisions<a hidden class="anchor" aria-hidden="true" href="#cross-divisions">#</a></h2>
<p>The examples above assume a single division - but we know that XclusiV is a multi-divisional organisation. How will it work with more than one division? We can have duplication of domains - to reflect the physical division of the organisation. This will also allow th organisation to scale if it decides to create or acquire new divisions or even divest divisions.</p>
<p>XclusiV could re-organise and have shared domains across the divisions, but this would be counter to the principles of data mesh, as domains should be aligned to the organisation. In addition, to re-organise into shared domains across divisions wouldn&rsquo;t be scalable and would impose some of the same challenges and restrictions of the current analytical structure.</p>
<p>For cross-divisional functions, like IT, we&rsquo;ll explore their role in <a href="../self-serve-platform-case-study-retail/">Self-Serve Analytical Platform Fictional Case Study: Retail</a> and for cross divisional consumers, like Group Finance, we&rsquo;ll explore how they would consume data in <a href="../data-product-case-study-retail/">Data Product Fictional Case Study: Retail</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Ust Does Tech</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
